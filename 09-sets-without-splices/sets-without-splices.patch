From 235e24506fc8ce6152587035865bf2cd45d56318 Mon Sep 17 00:00:00 2001
From: GitHub Copilot <copilot@github.com>
Date: Wed, 8 Oct 2025 07:01:17 +0000
Subject: [PATCH] Optimize syntax-quote for sets without splices (minimal)

---
 src/jvm/clojure/lang/LispReader.java | 12 +++++++++++-
 1 file changed, 11 insertions(+), 1 deletion(-)

diff --git a/src/jvm/clojure/lang/LispReader.java b/src/jvm/clojure/lang/LispReader.java
index 8d7079c..48aab27 100644
--- a/src/jvm/clojure/lang/LispReader.java
+++ b/src/jvm/clojure/lang/LispReader.java
@@ -1101,7 +1101,17 @@ public static class SyntaxQuoteReader extends AFn{
 				}
 			else if(form instanceof IPersistentSet)
 				{
-				ret = RT.list(APPLY, HASHSET, RT.list(SEQ, RT.cons(CONCAT, sqExpandList(((IPersistentSet) form).seq()))));
+				ISeq seq = ((IPersistentSet) form).seq();
+				// `#{} => #{}
+				if(seq == null)
+					ret = PersistentHashSet.EMPTY;
+				// `#{a} => #{`a}
+				else if(seq.count() == 1)
+					ret = PersistentHashSet.create(RT.toArray(syntaxQuote(seq.first())));
+				// `#{a b c} => (hash-set `a `b `c)
+				else
+					ret = RT.cons(HASHSET, sqExpandList(seq));
+				}
 				}
 			else if(form instanceof ISeq || form instanceof IPersistentList)
 				{
-- 
2.51.0

